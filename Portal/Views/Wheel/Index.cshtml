@{
    ViewData["Title"] = "Home Page";
}

@using Newtonsoft.Json
@model IEnumerable<Portal.Models.WheelSectionDto>
@{
    var flatData = Model
       .SelectMany(parent => new[] { parent }
           .Concat(parent.Children)
           .Concat(parent.Children.SelectMany(c => c.Children)))
       .Select(x => new { x.PkWheelId, x.Name });
}
<style>
    @@font-face {
        font-family: 'Gotham';
        src: url('/fonts/GothamMedium/Gotham Medium.otf') format('opentype');
        font-weight: normal;
        font-style: normal;
    }

    header {
        width: 100%;
    }

    body {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        min-height: 100vh;
        margin: 0;
        font-family: 'Gotham', sans-serif;
        background: #f0f0f0;
    }

    #chartContainer {
        position: relative;
    }

    svg {
        margin: auto;
        display: flex;
        justify-content: center;
        align-content: center
    }

    #chartContainer svg {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
    }

        #chartContainer svg .segment,
        #chartContainer svg .pencil-icon,
        #chartContainer svg .add-icon,
        #chartContainer svg .add-child-icon {
            cursor: pointer !important;
            pointer-events: all;
            outline: none;
            /* background-color:red; */
            border: none;
        }

    
</style>
<!-- Loader Overlay -->
<div id="loading" style="display:none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);  /* opacity 0.5 */
            z-index: 1050;
            display: flex;
            justify-content: center;
            align-items: center;">
    <div class="spinner-border text-light" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>
<div class="d-flex">




    <button class="btn btn-sm btn-primary mb-2 me-2" id="edit" onclick="toggleEdit()">
        Toggle Edit Mode
        @* <i class="fa-solid fa-plus"></i> *@
        <i class="ph ph-pen"></i>

    </button>
    <button class="btn btn-sm d-none btn-primary mb-2" onclick="openAddModal(null)">+ Add Wheel</button>
</div>

<div class="container-fluid position-relative" id="chartContainer" data-wheel='@Html.Raw(JsonConvert.SerializeObject(Model))' data-dropdown='@Html.Raw(JsonConvert.SerializeObject(flatData))'>
    <canvas id="wheelCanvas" class="m-auto"></canvas>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            @Html.AntiForgeryToken()

            <form id="editForm">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Section</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editId" />
                    <div class="mb-2">
                        <label>Name</label>
                        <input type="text" id="editName" class="form-control" />
                    </div>
                    <div class="mb-2">
                        <label>Colour</label>
                        <input type="color" id="editColour" class="form-control" />
                    </div>
                    <div class="mb-2">
                        <label for="editOrder">Order</label>
                        <input type="number" id="editOrder" class="form-control" />
                    </div>
                    <div class="mb-2">
                        <label for="editParent">Parent Section (optional)</label>
                        <select id="editParent" class="form-control">
                            <option value="">-- Top-level Section --</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="saveDelete()">Delete</button>
                    <button type="button" class="btn btn-primary" onclick="saveEdit()">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Modal -->
<div class="modal fade" id="addWheelModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            @Html.AntiForgeryToken()

            <form id="addWheelForm">
                <div class="modal-header">
                    <h5 class="modal-title">Add Wheel Section</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2">
                        <label for="newName">Name</label>
                        <input type="text" id="newName" class="form-control" />
                    </div>
                    <div class="mb-2">
                        <label for="newColour">Colour</label>
                        <input type="color" id="newColour" class="form-control" placeholder="#FF0000 or red" />
                    </div>
                    <div class="mb-2">
                        <label for="newOrder">Order</label>
                        <input type="number" id="newOrder" class="form-control" />
                    </div>
                    <div class="mb-2">
                        <label for="newParent">Parent Section (optional)</label>
                        <select id="newParent" disabled class="form-control">
                            <option value="">-- Top-level Section --</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="addNewSection()">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="~/js/wheel.js"></script>
}
